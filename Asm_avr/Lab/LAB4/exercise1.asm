.INCLUDE "m128def.inc"

.DEF ONES_DIGIT = R20
.DEF TENS_DIGIT = R21
.DEF temp = R22
.DEF COUNT = R23

.CSEG
.ORG 0x0000
	LDI R16, LOW(RAMEND)
	OUT SPL, R16
	LDI R16, HIGH(RAMEND)
	OUT SPH, R16
	
	LDI R16, 0x0F
	STS DDRF, R16
	
	LDI R16, 0xFF
	OUT DDRE, R16
	
	LDI COUNT, 0
	
LOOP:
	MOV ONES_DIGIT, COUNT
	CALL DISPLAY_TWO_DIGITS
	
	INC COUNT
	CPI COUNT, 60
	BRNE SKIP
	
	LDI COUNT, 50
	
SKIP:
	CALL D100MS
	JMP LOOP
	
DISPLAY_TWO_DIGITS:
	CALL DIGITS
	
	LDI R17, 0xEF
	OUT PORTE, R17
	STS PORTF, TENS_DIGIT

	CALL D1000MS
	
	LDI R17, 0xDF
	OUT PORTE, R17
	STS PORTF, ONES_DIGIT
	RET
	
DIGITS:
	PUSH temp
	LDI TENS_DIGIT, 0
	LDI temp, 10
	
REPEAT:
	SUB ONES_DIGIT, temp
	BRMI MINUS
	INC TENS_DIGIT
	RJMP REPEAT
	
MINUS:
	ADD ONES_DIGIT, temp
	POP temp
	RET
	
	; DELAY SUBROUTINE


D1000MS:
	RCALL D500MS
	RCALL D500MS
	RET
	
D500MS:
	RCALL D100MS
	RCALL D200MS
	RCALL D200MS
	RET
	
D100MS:
	LDI R18, 100
BASE1MS:
	RCALL D200US
	RCALL D200US
	RCALL D200US
	RCALL D200US
	RCALL D200US
	DEC R18
	BRNE BASE1MS
	RET
	
D200MS:
	LDI R18, 200
	RCALL D200US
	RCALL D200US
	RCALL D200US
	RCALL D200US
	RCALL D200US
	DEC R18
	BRNE BASE1MS
	RET
	
D200US:
	LDI R19, 200
BASE1US:
	NOP
	PUSH R19
	POP R19
	PUSH R19
	POP R19
	PUSH R19
	POP R19
	DEC R19
	BRNE BASE1US
	RET
